<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicles of Aethelgard | Choice-Based Adventure</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="game-container">
        <!-- Header Section -->
        <header>
            <h1><i class="fas fa-dragon"></i> Chronicles of Aethelgard</h1>
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-label">Chapter:</span>
                    <span id="chapter-counter">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Choices:</span>
                    <span id="choice-counter">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Time:</span>
                    <span id="time-display">Morning</span>
                </div>
            </div>
        </header>

        <!-- Main Game Area -->
        <main>
            <!-- Scene Display -->
            <div class="scene-container">
                <div class="scene-image" id="scene-image">
                    <!-- Background image will be set via CSS -->
                </div>
                <div class="scene-description" id="scene-text">
                    You awaken in a stone chamber, torchlight flickering on damp walls. 
                    The air smells of moss and ancient secrets. Your head throbs with 
                    forgotten memories. Three paths lie before you...
                </div>
            </div>

            <!-- Player Stats -->
            <div class="player-info">
                <div class="inventory">
                    <h3><i class="fas fa-backpack"></i> Inventory</h3>
                    <div id="inventory-items">
                        <div class="item">üó°Ô∏è Rusty Dagger</div>
                        <div class="item">üïØÔ∏è Torch</div>
                    </div>
                </div>
                
                <div class="relationships">
                    <h3><i class="fas fa-users"></i> Relationships</h3>
                    <div class="relationship-bar">
                        <div class="label">Guild Trust:</div>
                        <div class="bar-container">
                            <div class="bar-fill" id="guild-trust" style="width: 30%"></div>
                        </div>
                        <span class="percentage">30%</span>
                    </div>
                    <div class="relationship-bar">
                        <div class="label">Arcane Knowledge:</div>
                        <div class="bar-container">
                            <div class="bar-fill" id="knowledge" style="width: 15%"></div>
                        </div>
                        <span class="percentage">15%</span>
                    </div>
                </div>
            </div>

            <!-- Choices Section -->
            <div class="choices-container">
                <h3><i class="fas fa-crossroads"></i> What will you do?</h3>
                <div class="choices-grid" id="choices-container">
                    <!-- Choices will be dynamically inserted here -->
                </div>
            </div>

            <!-- Game History -->
            <div class="history-container">
                <h3><i class="fas fa-scroll"></i> Journey Log</h3>
                <div class="history-log" id="history-log">
                    <div class="log-entry">[Morning] You awaken in an unfamiliar chamber...</div>
                </div>
                <button class="btn-secondary" onclick="toggleHistory()">
                    <i class="fas fa-chevron-down"></i> Show/Hide Log
                </button>
            </div>
        </main>

        <!-- Footer Controls -->
        <footer>
            <div class="controls">
                <button class="btn-control" onclick="saveGame()" title="Save Game">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="btn-control" onclick="loadGame()" title="Load Game">
                    <i class="fas fa-folder-open"></i> Load
                </button>
                <button class="btn-control" onclick="resetGame()" title="Restart">
                    <i class="fas fa-redo"></i> Restart
                </button>
                <button class="btn-control" onclick="showEndings()" title="View Endings">
                    <i class="fas fa-trophy"></i> Endings
                </button>
                <div class="volume-control">
                    <i class="fas fa-volume-up"></i>
                    <input type="range" id="volume" min="0" max="100" value="70">
                </div>
            </div>
            <div class="game-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 10%"></div>
                </div>
                <div class="progress-label">Story Progress: <span id="progress-text">10%</span></div>
            </div>
        </footer>
    </div>

    <!-- Endings Modal -->
    <div id="endings-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2><i class="fas fa-crown"></i> Discovered Endings</h2>
            <div id="endings-list">
                <div class="ending locked">
                    <i class="fas fa-lock"></i> The King's Favor
                </div>
                <div class="ending locked">
                    <i class="fas fa-lock"></i> Master Wizard
                </div>
                <div class="ending locked">
                    <i class="fas fa-lock"></i> Shadow Lord
                </div>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #e6e6e6;
    min-height: 100vh;
    padding: 20px;
    line-height: 1.6;
}

.game-container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(25, 25, 35, 0.95);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    overflow: hidden;
    border: 1px solid #444;
}

/* Header */
header {
    background: linear-gradient(to right, #2d2d44, #3d3d5c);
    padding: 20px 30px;
    border-bottom: 2px solid #00a8ff;
}

header h1 {
    font-size: 2.5rem;
    background: linear-gradient(45deg, #00a8ff, #9c88ff);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.game-stats {
    display: flex;
    gap: 30px;
    background: rgba(0, 0, 0, 0.3);
    padding: 12px 20px;
    border-radius: 10px;
    border: 1px solid #444;
}

.stat {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.1rem;
}

.stat-label {
    color: #00a8ff;
    font-weight: bold;
}

/* Main Content Layout */
main {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 25px;
    padding: 25px;
}

/* Scene Display */
.scene-container {
    grid-column: 1;
    grid-row: 1;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid #444;
}

.scene-image {
    height: 250px;
    background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)),
                url('https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
    background-size: cover;
    background-position: center;
    position: relative;
}

.scene-description {
    padding: 25px;
    font-size: 1.2rem;
    line-height: 1.8;
    color: #f0f0f0;
    background: rgba(20, 20, 30, 0.9);
    min-height: 180px;
}

/* Player Info */
.player-info {
    grid-column: 2;
    grid-row: 1;
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.inventory, .relationships {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 15px;
    border: 1px solid #444;
}

.inventory h3, .relationships h3 {
    color: #00a8ff;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.3rem;
}

#inventory-items {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.item {
    background: rgba(0, 168, 255, 0.2);
    padding: 8px 15px;
    border-radius: 20px;
    border: 1px solid #00a8ff;
    font-size: 0.9rem;
}

.relationship-bar {
    margin-bottom: 15px;
}

.relationship-bar .label {
    font-size: 0.9rem;
    color: #aaa;
    margin-bottom: 5px;
}

.bar-container {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 5px;
}

.bar-fill {
    height: 100%;
    background: linear-gradient(to right, #00a8ff, #9c88ff);
    border-radius: 6px;
    transition: width 0.5s ease;
}

.percentage {
    font-size: 0.9rem;
    color: #00a8ff;
    float: right;
}

/* Choices Section */
.choices-container {
    grid-column: 1 / span 2;
    grid-row: 2;
    background: rgba(0, 0, 0, 0.3);
    padding: 25px;
    border-radius: 15px;
    border: 1px solid #444;
}

.choices-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.choice-btn {
    background: linear-gradient(135deg, #2d2d44, #3d3d5c);
    border: 2px solid #00a8ff;
    color: white;
    padding: 20px;
    border-radius: 12px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 15px;
    min-height: 100px;
}

.choice-btn:hover {
    transform: translateY(-5px);
    background: linear-gradient(135deg, #3d3d5c, #4d4d6c);
    box-shadow: 0 5px 15px rgba(0, 168, 255, 0.3);
    border-color: #9c88ff;
}

.choice-btn i {
    font-size: 1.5rem;
    color: #00a8ff;
}

.choice-btn.locked {
    opacity: 0.5;
    cursor: not-allowed;
    border-color: #666;
}

.choice-btn.locked:hover {
    transform: none;
    background: linear-gradient(135deg, #2d2d44, #3d3d5c);
    box-shadow: none;
}

/* History Log */
.history-container {
    grid-column: 1 / span 2;
    grid-row: 3;
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 15px;
    border: 1px solid #444;
    margin-top: 10px;
}

.history-log {
    max-height: 150px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.5);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    border: 1px solid #333;
}

.log-entry {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.95rem;
    color: #ccc;
}

.log-entry:last-child {
    border-bottom: none;
}

/* Footer Controls */
footer {
    background: linear-gradient(to right, #2d2d44, #3d3d5c);
    padding: 20px 30px;
    border-top: 2px solid #00a8ff;
}

.controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.btn-control, .btn-secondary {
    background: rgba(0, 168, 255, 0.2);
    border: 1px solid #00a8ff;
    color: white;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
}

.btn-control:hover, .btn-secondary:hover {
    background: rgba(0, 168, 255, 0.4);
    transform: translateY(-2px);
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(0, 0, 0, 0.3);
    padding: 10px 20px;
    border-radius: 8px;
    border: 1px solid #444;
}

.volume-control input {
    width: 100px;
}

.game-progress {
    text-align: center;
}

.progress-bar {
    width: 100%;
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(to right, #00a8ff, #9c88ff);
    border-radius: 5px;
    transition: width 0.5s ease;
}

.progress-label {
    color: #aaa;
    font-size: 0.9rem;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: #2d2d44;
    padding: 30px;
    border-radius: 15px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    border: 2px solid #00a8ff;
}

.close {
    float: right;
    font-size: 28px;
    cursor: pointer;
    color: #00a8ff;
}

.ending {
    padding: 15px;
    margin: 10px 0;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.ending.unlocked {
    border-left: 4px solid #00a8ff;
    background: rgba(0, 168, 255, 0.1);
}

.ending.locked {
    color: #666;
    border-left: 4px solid #444;
}

/* Responsive Design */
@media (max-width: 768px) {
    main {
        grid-template-columns: 1fr;
    }
    
    .scene-container, .player-info, .choices-container, .history-container {
        grid-column: 1;
    }
    
    .choices-grid {
        grid-template-columns: 1fr;
    }
    
    header h1 {
        font-size: 1.8rem;
    }
    
    .game-stats {
        flex-direction: column;
        gap: 10px;
    }
}
// Game State
const gameState = {
    chapter: 1,
    scene: 'start',
    choices: 0,
    time: 'Morning',
    progress: 10,
    inventory: ['üó°Ô∏è Rusty Dagger', 'üïØÔ∏è Torch', 'üß≠ Basic Compass'],
    stats: {
        guildTrust: 30,
        arcaneKnowledge: 15,
        shadowInfluence: 0,
        royalFavor: 0
    },
    history: ['[Morning] You awaken in an unfamiliar chamber...'],
    flags: {
        metMysteriousStranger: false,
        foundAncientTome: false,
        joinedThievesGuild: false,
        helpedGuardCaptain: false
    },
    endings: []
};

// Game Data - Scenes and Choices
const gameData = {
    scenes: {
        start: {
            id: 'start',
            title: 'The Awakening',
            description: 'You awaken in a stone chamber, torchlight flickering on damp walls. The air smells of moss and ancient secrets. Your head throbs with forgotten memories. Three paths lie before you...',
            image: 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            choices: [
                {
                    id: 'explore_tunnels',
                    text: 'Explore the dark tunnels to the east',
                    icon: 'fas fa-torii-gate',
                    nextScene: 'tunnels',
                    requirements: null,
                    effects: {
                        arcaneKnowledge: 5,
                        history: '[Choice] You venture into the dark eastern tunnels...'
                    }
                },
                {
                    id: 'climb_stairs',
                    text: 'Climb the crumbling stone stairs upward',
                    icon: 'fas fa-stairs',
                    nextScene: 'tower',
                    requirements: null,
                    effects: {
                        guildTrust: 10,
                        history: '[Choice] You ascend the ancient stone stairs...'
                    }
                },
                {
                    id: 'examine_symbols',
                    text: 'Examine the strange symbols on the wall',
                    icon: 'fas fa-book',
                    nextScene: 'symbols',
                    requirements: { arcaneKnowledge: 10 },
                    effects: {
                        arcaneKnowledge: 15,
                        history: '[Choice] You study the mysterious wall symbols...'
                    }
                }
            ]
        },
        
        tunnels: {
            id: 'tunnels',
            title: 'Forgotten Tunnels',
            description: 'The tunnels wind deeper into darkness. The air grows colder, and you hear distant dripping water. A faint blue glow emanates from a side passage.',
            image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            choices: [
                {
                    id: 'follow_glow',
                    text: 'Follow the mysterious blue glow',
                    icon: 'fas fa-magic',
                    nextScene: 'glowing_chamber',
                    effects: {
                        arcaneKnowledge: 20,
                        history: '[Choice] You follow the eerie blue glow...'
                    }
                },
                {
                    id: 'listen_water',
                    text: 'Follow the sound of dripping water',
                    icon: 'fas fa-tint',
                    nextScene: 'underground_river',
                    effects: {
                        inventory: 'üíß Mysterious Water',
                        history: '[Choice] You follow the sound of water...'
                    }
                },
                {
                    id: 'return_chamber',
                    text: 'Return to the starting chamber',
                    icon: 'fas fa-undo',
                    nextScene: 'start',
                    effects: {
                        history: '[Choice] You retreat back to the starting chamber...'
                    }
                }
            ]
        },
        
        tower: {
            id: 'tower',
            title: 'The Watchtower',
            description: 'You emerge into a circular room at the top of a tower. Through arrow slits, you see a sprawling medieval city below. A figure stands silhouetted against the window.',
            image: 'https://images.unsplash.com/photo-1533134486753-c833f0ed4866?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            choices: [
                {
                    id: 'approach_figure',
                    text: 'Approach the mysterious figure',
                    icon: 'fas fa-user',
                    nextScene: 'captain_meeting',
                    effects: {
                        guildTrust: 20,
                        history: '[Choice] You approach the shadowy figure...'
                    }
                },
                {
                    id: 'look_out_window',
                    text: 'Look out the window at the city',
                    icon: 'fas fa-city',
                    nextScene: 'city_view',
                    effects: {
                        inventory: 'üó∫Ô∏è City Map',
                        history: '[Choice] You study the city layout from above...'
                    }
                },
                {
                    id: 'search_room',
                    text: 'Search the room for clues',
                    icon: 'fas fa-search',
                    nextScene: 'tower_search',
                    effects: {
                        arcaneKnowledge: 10,
                        inventory: 'üîë Rusty Key',
                        history: '[Choice] You search the tower room thoroughly...'
                    }
                }
            ]
        },
        
        glowing_chamber: {
            id: 'glowing_chamber',
            title: 'The Glowing Chamber',
            description: 'The chamber pulses with blue energy. Ancient runes cover every surface, and a pedestal holds a glowing crystal. The air crackles with magical energy.',
            image: 'https://images.unsplash.com/photo-1531306728370-e2ebd9d7bbcc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            choices: [
                {
                    id: 'touch_crystal',
                    text: 'Touch the glowing crystal',
                    icon: 'fas fa-gem',
                    nextScene: 'crystal_vision',
                    requirements: { arcaneKnowledge: 25 },
                    effects: {
                        arcaneKnowledge: 30,
                        history: '[Choice] You reach for the pulsating crystal...'
                    }
                },
                {
                    id: 'study_runes',
                    text: 'Study the ancient runes',
                    icon: 'fas fa-scroll',
                    nextScene: 'rune_study',
                    effects: {
                        arcaneKnowledge: 25,
                        history: '[Choice] You decipher the ancient runes...'
                    }
                },
                {
                    id: 'leave_chamber',
                    text: 'Leave this unnatural place',
                    icon: 'fas fa-running',
                    nextScene: 'tunnels',
                    effects: {
                        history: '[Choice] You flee from the eerie chamber...'
                    }
                }
            ]
        },
        
        captain_meeting: {
            id: 'captain_meeting',
            title: 'The Guard Captain',
            description: 'The figure turns - it\'s Captain Valerius of the City Guard. "You shouldn\'t be here," he says sternly. "But since you are... I could use someone with your apparent... curiosity."',
            image: 'https://images.unsplash.com/photo-1547891654-e66ed7ebb968?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            choices: [
                {
                    id: 'accept_mission',
                    text: 'Accept the Captain\'s mission',
                    icon: 'fas fa-handshake',
                    nextScene: 'guard_mission',
                    effects: {
                        guildTrust: 40,
                        royalFavor: 20,
                        history: '[Choice] You agree to help the Guard Captain...'
                    }
                },
                {
                    id: 'ask_questions',
                    text: 'Ask why you were imprisoned',
                    icon: 'fas fa-question',
                    nextScene: 'interrogation',
                    effects: {
                        arcaneKnowledge: 15,
                        history: '[Choice] You demand answers from the Captain...'
                    }
                },
                {
                    id: 'refuse_mission',
                    text: 'Refuse and try to leave',
                    icon: 'fas fa-door-closed',
                    nextScene: 'tower_escape',
                    effects: {
                        guildTrust: -20,
                        history: '[Choice] You refuse the Captain and try to escape...'
                    }
                }
            ]
        }
    },
    
    endings: {
        wizard: {
            id: 'wizard',
            title: 'Archmage of Aethelgard',
            description: 'Your pursuit of arcane knowledge leads you to master ancient magic. You become the court wizard, advising kings and shaping history with your power.',
            requirement: { arcaneKnowledge: 80 }
        },
        king: {
            id: 'king',
            title: 'Royal Advisor',
            description: 'Through loyalty and service, you earn the king\'s trust. You become a powerful advisor, helping to rule the kingdom with wisdom and justice.',
            requirement: { royalFavor: 70, guildTrust: 60 }
        },
        shadow: {
            id: 'shadow',
            title: 'Shadow Master',
            description: 'You embrace the underworld, building a network of spies and assassins. From the shadows, you control the fate of nations unseen.',
            requirement: { shadowInfluence: 75 }
        }
    }
};

// DOM Elements
const sceneText = document.getElementById('scene-text');
const choicesContainer = document.getElementById('choices-container');
const historyLog = document.getElementById('history-log');
const chapterCounter = document.getElementById('chapter-counter');
const choiceCounter = document.getElementById('choice-counter');
const timeDisplay = document.getElementById('time-display');
const inventoryItems = document.getElementById('inventory-items');
const progressFill = document.getElementById('progress-fill');
const progressText = document.getElementById('progress-text');
const guildTrustBar = document.getElementById('guild-trust');
const knowledgeBar = document.getElementById('knowledge');

// Initialize Game
function initGame() {
    loadGame(); // Try to load saved game
    renderScene(gameState.scene);
    updateUI();
}

// Render Current Scene
function renderScene(sceneId) {
    const scene = gameData.scenes[sceneId];
    if (!scene) return;
    
    // Update scene display
    sceneText.textContent = scene.description;
    document.getElementById('scene-image').style.backgroundImage = 
        `linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('${scene.image}')`;
    
    // Clear previous choices
    choicesContainer.innerHTML = '';
    
    // Render available choices
    scene.choices.forEach(choice => {
        const isAvailable = checkRequirements(choice.requirements);
        
        const choiceElement = document.createElement('button');
        choiceElement.className = `choice-btn ${!isAvailable ? 'locked' : ''}`;
        choiceElement.innerHTML = `
            <i class="${choice.icon}"></i>
            <span>${choice.text}</span>
        `;
        
        if (isAvailable) {
            choiceElement.onclick = () => makeChoice(choice);
        } else {
            choiceElement.onclick = null;
            choiceElement.title = 'Requires more arcane knowledge';
        }
        
        choicesContainer.appendChild(choiceElement);
    });
    
    // Add to history
    addToHistory(`[${gameState.time}] Arrived at: ${scene.title}`);
}

// Make a Choice
function makeChoice(choice) {
    // Update game state
    gameState.choices++;
    gameState.chapter++;
    gameState.scene = choice.nextScene;
    
    // Apply choice effects
    if (choice.effects) {
        Object.keys(choice.effects).forEach(effect => {
            if (effect === 'history') {
                addToHistory(choice.effects[effect]);
            } else if (effect === 'inventory' && typeof choice.effects[effect] === 'string') {
                if (!gameState.inventory.includes(choice.effects[effect])) {
                    gameState.inventory.push(choice.effects[effect]);
                }
            } else if (gameState.stats[effect] !== undefined) {
                gameState.stats[effect] += choice.effects[effect];
                gameState.stats[effect] = Math.max(0, Math.min(100, gameState.stats[effect]));
            }
        });
    }
    
    // Update time
    updateTime();
    
    // Update progress
    gameState.progress = Math.min(100, gameState.progress + Math.floor(Math.random() * 5) + 3);
    
    // Check for endings
    checkEndings();
    
    // Update UI and render next scene
    updateUI();
    renderScene(gameState.scene);
}

// Check Requirements for Choices
function checkRequirements(requirements) {
    if (!requirements) return true;
    
    for (const [stat, value] of Object.entries(requirements)) {
        if (gameState.stats[stat] < value) {
            return false;
        }
    }
    return true;
}

// Update Game Time
function updateTime() {
    const times = ['Morning', 'Afternoon', 'Evening', 'Night'];
    const currentIndex = times.indexOf(gameState.time);
    gameState.time = times[(currentIndex + 1) % times.length];
}

// Update UI Elements
function updateUI() {
    chapterCounter.textContent = gameState.chapter;
    choiceCounter.textContent = gameState.choices;
    timeDisplay.textContent = gameState.time;
    
    // Update inventory
    inventoryItems.innerHTML = '';
    gameState.inventory.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'item';
        itemElement.textContent = item;
        inventoryItems.appendChild(itemElement);
    });
    
    // Update stats bars
    guildTrustBar.style.width = `${gameState.stats.guildTrust}%`;
    guildTrustBar.nextElementSibling.textContent = `${gameState.stats.guildTrust}%`;
    
    knowledgeBar.style.width = `${gameState.stats.arcaneKnowledge}%`;
    knowledgeBar.nextElementSibling.textContent = `${gameState.stats.arcaneKnowledge}%`;
    
    // Update progress
    progressFill.style.width = `${gameState.progress}%`;
    progressText.textContent = `${gameState.progress}%`;
    
    // Auto-scroll history to bottom
    historyLog.scrollTop = historyLog.scrollHeight;
}

// Add Entry to History
function addToHistory(entry) {
    const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    gameState.history.push(`[${now}] ${entry}`);
    
    // Update history display
    historyLog.innerHTML = '';
    gameState.history.slice(-10).forEach(entry => {
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.textContent = entry;
        historyLog.appendChild(logEntry);
    });
}

// Check for Endings
function checkEndings() {
    Object.entries(gameData.endings).forEach(([endingId, ending]) => {
        if (!gameState.endings.includes(endingId) && checkRequirements(ending.requirement)) {
            gameState.endings.push(endingId);
            showEnding(ending);
        }
    });
}

// Show Ending
function showEnding(ending) {
    addToHistory(`üéâ ACHIEVEMENT UNLOCKED: ${ending.title}`);
    
    // Update endings modal
    const endingsList = document.getElementById('endings-list');
    const endingElement = document.createElement('div');
    endingElement.className = 'ending unlocked';
    endingElement.innerHTML = `
        <i class="fas fa-crown"></i>
        <div>
            <strong>${ending.title}</strong><br>
            <small>${ending.description}</small>
        </div>
    `;
    endingsList.appendChild(endingElement);
    
    // Show modal
    document.getElementById('endings-modal').style.display = 'flex';
}

// Save Game
function saveGame() {
    localStorage.setItem('choiceGameSave', JSON.stringify(gameState));
    addToHistory('Game saved successfully');
    
    // Visual feedback
    const saveBtn = document.querySelector('[onclick="saveGame()"]');
    const originalHTML = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
    setTimeout(() => {
        saveBtn.innerHTML = originalHTML;
    }, 1500);
}

// Load Game
function loadGame() {
    const saved = localStorage.getItem('choiceGameSave');
    if (saved) {
        try {
            const loadedState = JSON.parse(saved);
            Object.assign(gameState, loadedState);
            addToHistory('Game loaded from save');
        } catch (e) {
            console.error('Failed to load save:', e);
        }
    }
}

// Reset Game
function resetGame() {
    if (confirm('Are you sure you want to restart? All progress will be lost.')) {
        localStorage.removeItem('choiceGameSave');
        
        // Reset game state
        Object.assign(gameState, {
            chapter: 1,
            scene: 'start',
            choices: 0,
            time: 'Morning',
            progress: 10,
            inventory: ['üó°Ô∏è Rusty Dagger', 'üïØÔ∏è Torch', 'üß≠ Basic Compass'],
            stats: {
                guildTrust: 30,
                arcaneKnowledge: 15,
                shadowInfluence: 0,
                royalFavor: 0
            },
            history: ['[Morning] You awaken in an unfamiliar chamber...'],
            flags: {
                metMysteriousStranger: false,
                foundAncientTome: false,
                joinedThievesGuild: false,
                helpedGuardCaptain: false
            },
            endings: []
        });
        
        // Reset UI
        const endingsList = document.getElementById('endings-list');
        endingsList.innerHTML = `
            <div class="ending locked">
                <i class="fas fa-lock"></i> The King's Favor
            </div>
            <div class="ending locked">
                <i class="fas fa-lock"></i> Master Wizard
            </div>
            <div class="ending locked">
                <i class="fas fa-lock"></i> Shadow Lord
            </div>
        `;
        
        // Restart game
        renderScene('start');
        updateUI();
        addToHistory('Game restarted from beginning');
    }
}

// Toggle History Log
function toggleHistory() {
    const historyContainer = document.querySelector('.history-container');
    const historyLog = document.querySelector('.history-log');
    const toggleBtn = document.querySelector('[onclick="toggleHistory()"]');
    
    if (historyLog.style.maxHeight === '0px' || !historyLog.style.maxHeight) {
        historyLog.style.maxHeight = '150px';
        historyLog.style.overflowY = 'auto';
        toggleBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Log';
    } else {
        historyLog.style.maxHeight = '0';
        historyLog.style.overflowY = 'hidden';
        toggleBtn.innerHTML = '<i class="fas fa-chevron-down"></i> Show Log';
    }
}

// Show Endings Modal
function showEndings() {
    document.getElementById('endings-modal').style.display = 'flex';
}

// Close Modal
function closeModal() {
    document.getElementById('endings-modal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('endings-modal');
    if (event.target === modal) {
        closeModal();
    }
};

// Volume Control
document.getElementById('volume').addEventListener('input', function(e) {
    const value = e.target.value;
    // In a real game, you would adjust audio volume here
    console.log(`Volume set to ${value}%`);
});

// Initialize game when page loads
window.onload = initGame;
